/*
 *  Copyright 2018 KardiaChain
 *  This file is part of the go-kardia library.
 *
 *  The go-kardia library is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Lesser General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  The go-kardia library is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 *  GNU Lesser General Public License for more details.
 *
 *  You should have received a copy of the GNU Lesser General Public License
 *  along with the go-kardia library. If not, see <http://www.gnu.org/licenses/>.
 */

package dpos

import (
	"encoding/hex"
	"math"
	"math/big"
	"strings"
	"testing"

	"github.com/kardiachain/go-kardiamain/kai/kaidb/memorydb"
	"github.com/kardiachain/go-kardiamain/kai/storage/kvstore"
	"github.com/kardiachain/go-kardiamain/kvm/sample_kvm"
	"github.com/kardiachain/go-kardiamain/lib/abi"
	"github.com/kardiachain/go-kardiamain/lib/common"
	"github.com/kardiachain/go-kardiamain/lib/crypto"
	"github.com/kardiachain/go-kardiamain/lib/log"
	"github.com/kardiachain/go-kardiamain/mainchain/blockchain"
	"github.com/kardiachain/go-kardiamain/mainchain/genesis"
	"github.com/kardiachain/go-kardiamain/types"
)

var stakingSmcCode = common.Hex2Bytes("6080604052600436106102a5576000357c0100000000000000000000000000000000000000000000000000000000900480635e5a3cb611610177578063c4e41b22116100de578063e0a8ed5211610097578063e0a8ed5214610cb9578063e2d5f71c14610ce3578063f1484c4314610d25578063f2fde38b14610d3a578063f679d30514610d6d578063f7ea7a3d14610d82576102a5565b8063c4e41b2214610be6578063c662fe6414610bfb578063d0e30db014610c36578063d50ac65614610c3e578063d5a9577114610c71578063e0331c8d14610c86576102a5565b8063a559f70211610130578063a559f702146109ff578063a6f41a4014610a3a578063adffefe314610a96578063b7ab4db514610aab578063b86e321c14610b9e578063be0522e014610bd1576102a5565b80635e5a3cb6146109475780636ec01b271461095c578063715018a61461098f57806386f7c372146109a45780638da5cb5b146109b95780638f29c8aa146109ea576102a5565b80633a68ee031161021b5780634d99dd16116101d45780634d99dd161461081b5780635028e2e1146108545780635128823a1461088f57806351cff8d9146108bf5780635a3f10ed146108f25780635c19a95c14610921576102a5565b80633a68ee03146106805780633fba6bd4146106bf57806344d96e951461078b57806345c5e147146107a0578063473691a4146107d35780634cef9e6f14610806576102a5565b806318824ab31161026d57806318824ab31461036b5780631904bb2e146103955780631e37e810146103e857806324f3ef461461041257806332bb15ba146105ca57806336e22c981461064d576102a5565b80630bde076d146102aa5780631249c58b146102c1578063135973fb146102e857806315049a5a1461031b57806318160ddd14610356575b600080fd5b3480156102b657600080fd5b506102bf610dac565b005b3480156102cd57600080fd5b506102d6610db7565b60408051918252519081900360200190f35b3480156102f457600080fd5b506102bf6004803603602081101561030b57600080fd5b5035600160a060020a0316610e80565b34801561032757600080fd5b506102d66004803603604081101561033e57600080fd5b50600160a060020a0381358116916020013516610f06565b34801561036257600080fd5b506102d6610fc1565b34801561037757600080fd5b506102bf6004803603602081101561038e57600080fd5b5035610fc7565b3480156103a157600080fd5b506103c8600480360360208110156103b857600080fd5b5035600160a060020a0316611030565b604080519384526020840192909252151582820152519081900360600190f35b3480156103f457600080fd5b506102bf6004803603602081101561040b57600080fd5b5035611152565b34801561041e57600080fd5b506102bf6004803603606081101561043557600080fd5b81019060208101813564010000000081111561045057600080fd5b82018360208201111561046257600080fd5b8035906020019184602083028401116401000000008311171561048457600080fd5b91908080602002602001604051908101604052809392919081815260200183836020028082843760009201919091525092959493602081019350359150506401000000008111156104d457600080fd5b8201836020820111156104e657600080fd5b8035906020019184602083028401116401000000008311171561050857600080fd5b919080806020026020016040519081016040528093929190818152602001838360200280828437600092019190915250929594936020810193503591505064010000000081111561055857600080fd5b82018360208201111561056a57600080fd5b8035906020019184602083028401116401000000008311171561058c57600080fd5b9190808060200260200160405190810160405280939291908181526020018383602002808284376000920191909152509295506111bb945050505050565b3480156105d657600080fd5b506105fd600480360360208110156105ed57600080fd5b5035600160a060020a031661122f565b60408051602080825283518183015283519192839290830191858101910280838360005b83811015610639578181015183820152602001610621565b505050509050019250505060405180910390f35b34801561065957600080fd5b506102d66004803603602081101561067057600080fd5b5035600160a060020a03166112ec565b34801561068c57600080fd5b506102bf600480360360608110156106a357600080fd5b50600160a060020a03813516906020810135906040013561135e565b3480156106cb57600080fd5b506106f2600480360360208110156106e257600080fd5b5035600160a060020a0316611369565b604051808060200180602001838103835285818151815260200191508051906020019060200280838360005b8381101561073657818101518382015260200161071e565b50505050905001838103825284818151815260200191508051906020019060200280838360005b8381101561077557818101518382015260200161075d565b5050505090500194505050505060405180910390f35b34801561079757600080fd5b506102d66114e6565b3480156107ac57600080fd5b506106f2600480360360208110156107c357600080fd5b5035600160a060020a03166114ec565b3480156107df57600080fd5b506102d6600480360360208110156107f657600080fd5b5035600160a060020a031661161e565b34801561081257600080fd5b506102d6611651565b34801561082757600080fd5b506102bf6004803603604081101561083e57600080fd5b50600160a060020a038135169060200135611657565b34801561086057600080fd5b506102d66004803603604081101561087757600080fd5b50600160a060020a03813581169160200135166116be565b34801561089b57600080fd5b506102bf600480360360408110156108b257600080fd5b5080359060200135611786565b3480156108cb57600080fd5b506102bf600480360360208110156108e257600080fd5b5035600160a060020a0316611791565b6102bf6004803603608081101561090857600080fd5b508035906020810135906040810135906060013561179e565b6102bf6004803603602081101561093757600080fd5b5035600160a060020a0316611806565b34801561095357600080fd5b506106f26118bc565b34801561096857600080fd5b506102d66004803603602081101561097f57600080fd5b5035600160a060020a03166119e7565b34801561099b57600080fd5b506102bf611a02565b3480156109b057600080fd5b506102d6611ab0565b3480156109c557600080fd5b506109ce611be9565b60408051600160a060020a039092168252519081900360200190f35b3480156109f657600080fd5b506102d6611bf8565b348015610a0b57600080fd5b506106f260048036036040811015610a2257600080fd5b50600160a060020a0381358116916020013516611c16565b348015610a4657600080fd5b506102bf6004803603610120811015610a5e57600080fd5b5080359060208101359060408101359060608101359060808101359060a08101359060c08101359060e0810135906101000135611d76565b348015610aa257600080fd5b506102d6611e51565b348015610ab757600080fd5b50610ac0611e6a565b60405180806020018060200180602001848103845287818151815260200191508051906020019060200280838360005b83811015610b08578181015183820152602001610af0565b50505050905001848103835286818151815260200191508051906020019060200280838360005b83811015610b47578181015183820152602001610b2f565b50505050905001848103825285818151815260200191508051906020019060200280838360005b83811015610b86578181015183820152602001610b6e565b50505050905001965050505050505060405180910390f35b348015610baa57600080fd5b506102bf60048036036020811015610bc157600080fd5b5035600160a060020a0316611fef565b348015610bdd57600080fd5b506102d661207f565b348015610bf257600080fd5b506102d6612085565b348015610c0757600080fd5b506102d660048036036040811015610c1e57600080fd5b50600160a060020a038135811691602001351661208b565b6102bf610db5565b348015610c4a57600080fd5b506105fd60048036036020811015610c6157600080fd5b5035600160a060020a0316612277565b348015610c7d57600080fd5b506102d6612313565b348015610c9257600080fd5b506102d660048036036020811015610ca957600080fd5b5035600160a060020a0316612319565b348015610cc557600080fd5b506102bf60048036036020811015610cdc57600080fd5b5035612395565b348015610cef57600080fd5b506102bf600480360360a0811015610d0657600080fd5b50803590602081013590604081013590606081013590608001356123fe565b348015610d3157600080fd5b506106f26124a5565b348015610d4657600080fd5b506102bf60048036036020811015610d5d57600080fd5b5035600160a060020a031661255c565b348015610d7957600080fd5b506102bf612663565b348015610d8e57600080fd5b506102bf60048036036020811015610da557600080fd5b50356126a1565b610db53361270a565b565b60008054600160a060020a03161580610dda5750600054600160a060020a031633145b610e1c576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b610e24611ab0565b601355610e2f611bf8565b601455610e3a611e51565b6015819055601180548201905560408051918252517f176b02bb2d12439ff7a20b59f402cca16c76f50508b13ef3166a600eb719354a9181900360200190a15060155490565b600054600160a060020a03161580610ea25750600054600160a060020a031633145b610ee4576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b60248054600160a060020a031916600160a060020a0392909216919091179055565b600160a060020a0382166000908152600d60205260408120610f2e908363ffffffff61284516565b610f70576040805160e560020a62461bcd028152602060048201526014602482015260008051602061553c833981519152604482015290519081900360640190fd5b610f78615363565b5050600160a060020a038083166000908152600b602090815260408083208585168452825291829020825180840190935280548084526001909101549093169101525b92915050565b60115481565b600054600160a060020a03161580610fe95750600054600160a060020a031633145b61102b576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b601455565b6000808061104560048563ffffffff61284516565b611087576040805160e560020a62461bcd02815260206004820152601360248201526000805160206154aa833981519152604482015290519081900360640190fd5b61108f61537a565b50505050600160a060020a0390811660009081526003602081815260409283902083516101408101855281549095168552600181015485830190815260028201548686019081529382015460ff161515606080880191825286519081018752600484015481526005840154948101949094526006830154848701526080870193909352600782015460a0870152600882015460c0870152600982015460e0870152600c909101546101008601529251610120909401939093529051905191519092565b600054600160a060020a031615806111745750600054600160a060020a031633145b6111b6576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b601255565b600054600160a060020a031615806111dd5750600054600160a060020a031633145b61121f576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b61122a838383612861565b505050565b600160a060020a0381166000908152600c602052604081206060919061125490612958565b9050606081604051908082528060200260200182016040528015611282578160200160208202803883390190505b50905060005b828110156112e457600160a060020a0385166000908152600c602052604090206112b8908263ffffffff61296316565b8282815181106112c457fe5b600160a060020a0390921660209283029190910190910152600101611288565b509392505050565b600160a060020a0381166000908152600c60205260408120819061130f90612958565b90506000805b828110156112e457600160a060020a0385166000908152600c60205260408120611345908363ffffffff61296316565b9050611351818761208b565b9092019150600101611315565b61122a83838361296f565b60608061137d60048463ffffffff61284516565b6113bf576040805160e560020a62461bcd02815260206004820152601360248201526000805160206154aa833981519152604482015290519081900360640190fd5b600160a060020a0383166000908152600d602052604081206113e090612958565b905060608160405190808252806020026020018201604052801561140e578160200160208202803883390190505b50905060608260405190808252806020026020018201604052801561143d578160200160208202803883390190505b50905060005b838110156114da57600160a060020a0387166000908152600d60205260408120611473908363ffffffff61296316565b90508084838151811061148257fe5b600160a060020a039283166020918202929092018101919091528982166000908152600b82526040808220938516825292909152205483518490849081106114c657fe5b602090810291909101015250600101611443565b50909350915050915091565b60125481565b60608060006003600085600160a060020a0316600160a060020a03168152602001908152602001600020600c01549050606081604051908082528060200260200182016040528015611548578160200160208202803883390190505b509050606082604051908082528060200260200182016040528015611577578160200160208202803883390190505b50905060005b8381101561161357600160a060020a0387166000908152600360209081526040808320848452600b0190915290206001015483518490839081106115bd57fe5b602090810291909101810191909152600160a060020a0388166000908152600382526040808220848352600b019092522060020154825183908390811061160057fe5b602090810291909101015260010161157d565b509350915050915091565b600160a060020a038116600090815260036020526040812060010154610fbb90662386f26fc1000063ffffffff612a3016565b60145481565b600081116116af576040805160e560020a62461bcd02815260206004820152601960248201527f696e76616c696420756e64656c656761746520616d6f756e7400000000000000604482015290519081900360640190fd5b6116ba823383612a72565b5050565b600160a060020a0382166000908152600d602052604081206116e6908363ffffffff61284516565b611728576040805160e560020a62461bcd028152602060048201526014602482015260008051602061553c833981519152604482015290519081900360640190fd5b611730615363565b50600160a060020a038084166000908152600b60209081526040808320868516845282529182902082518084019093528054808452600190910154909316908201529061177e908590612d68565b949350505050565b6116ba338383612e48565b61179b81336130be565b50565b6117ac3334868686866133da565b60408051338152346020820152808201869052606081018590526080810184905260a0810183905290517f05d343d8c69939dd5b3aa8c5e5e628c34a05cee0070b7935d67a041b27ce8f1e9181900360c00190a150505050565b61181760048263ffffffff61284516565b611859576040805160e560020a62461bcd02815260206004820152601360248201526000805160206154aa833981519152604482015290519081900360640190fd5b600034116118b1576040805160e560020a62461bcd02815260206004820152601960248201527f696e76616c69642064656c65676174696f6e20616d6f756e7400000000000000604482015290519081900360640190fd5b61179b338234613680565b601854600e5460609182918111156118d35750600e545b6060816040519080825280602002602001820160405280156118ff578160200160208202803883390190505b50905060608260405190808252806020026020018201604052801561192e578160200160208202803883390190505b50905060005b838110156119dc57600e818154811061194957fe5b9060005260206000200160009054906101000a9004600160a060020a031683828151811061197357fe5b6020026020010190600160a060020a03169081600160a060020a0316815250506119bd600e82815481106119a357fe5b600091825260209091200154600160a060020a031661161e565b8282815181106119c957fe5b6020908102919091010152600101611934565b509093509150509091565b600160a060020a03166000908152600a602052604090205490565b600054600160a060020a03161580611a245750600054600160a060020a031633145b611a66576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b60008054604051600160a060020a03909116907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a360008054600160a060020a0319169055565b600080611aca60115460125461381490919063ffffffff16565b9050600080600080670de0b6b3a764000090506016600a0154851015611b5757601f54602054611b239190611b1790611b0a90899063ffffffff61381416565b849063ffffffff61384916565b9063ffffffff61388b16565b602154909450611b3a90859063ffffffff612a3016565b601354909350611b50908463ffffffff61389e16565b9150611bc0565b601f54602054611b859190611b17908490611b79908a9063ffffffff61381416565b9063ffffffff61384916565b602154909450611b9c90859063ffffffff612a3016565b9250826013541115611bbb57601354611b50908463ffffffff61384916565b600091505b602254821115611bd05760225491505b602354821015611be05760235491505b50935050505090565b600054600160a060020a031690565b6000611c1160115460135461388b90919063ffffffff16565b905090565b600160a060020a038083166000908152600660209081526040808320938516835292815290829020548251818152818302810190920190925260609182918290828015611c6d578160200160208202803883390190505b509050606082604051908082528060200260200182016040528015611c9c578160200160208202803883390190505b50905060005b83811015611d6957600160a060020a038089166000908152600660209081526040808320938b16835292905220805482908110611cdb57fe5b906000526020600020906003020160020154828281518110611cf957fe5b602090810291909101810191909152600160a060020a03808a166000908152600683526040808220928b168252919092529020805482908110611d3857fe5b906000526020600020906003020160000154838281518110611d5657fe5b6020908102919091010152600101611ca2565b5090969095509350505050565b600054600160a060020a03161580611d985750600054600160a060020a031633145b611dda576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b8815611de65760188990555b8715611df25760198890555b8615611dfe5760168790555b8515611e0a5760178690555b8415611e1657601a8590555b8315611e2257601b8490555b8215611e2e57601c8390555b8115611e3a57601d8290555b8015611e4657601e8190555b505050505050505050565b602154601454600091611c11919063ffffffff612a3016565b60608060606000611e7b6004612958565b9050606081604051908082528060200260200182016040528015611ea9578160200160208202803883390190505b509050606082604051908082528060200260200182016040528015611ed8578160200160208202803883390190505b509050606083604051908082528060200260200182016040528015611f07578160200160208202803883390190505b50905060005b84811015611fe1576000611f2860048363ffffffff61296316565b905080858381518110611f3757fe5b6020026020010190600160a060020a03169081600160a060020a0316815250506003600082600160a060020a0316600160a060020a0316815260200190815260200160002060010154848381518110611f8c57fe5b6020026020010181815250506003600082600160a060020a0316600160a060020a0316815260200190815260200160002060020154838381518110611fcd57fe5b602090810291909101015250600101611f0d565b509195509350915050909192565b600160a060020a0381166000908152600d60205260409020612017903363ffffffff61284516565b61206b576040805160e560020a62461bcd02815260206004820152601360248201527f64656c656761746f72206e6f7420666f756e6400000000000000000000000000604482015290519081900360640190fd5b61207581336138fb565b61179b8133613a0f565b60135481565b60115490565b600160a060020a0382166000908152600d602052604081206120b3908363ffffffff61284516565b6120f5576040805160e560020a62461bcd028152602060048201526014602482015260008051602061553c833981519152604482015290519081900360640190fd5b6120fd61537a565b50600160a060020a03808416600090815260036020818152604092839020835161014081018552815490951685526001810154858301526002810154858501529182015460ff16151560608086019190915283519081018452600483015481526005830154918101919091526006820154818401526080840152600781015460a0840152600881015460c0840152600981015460e0840152600c0154610100830152516101208201526121ae615363565b50600160a060020a038085166000818152600b60209081526040808320888616845282528083208151808301835281548152600190910154909516858301529282526008905290812054612209908790879060001901613ac3565b600160a060020a038716600090815260086020526040902060010154909150801561226d57600061223e888560000151612d68565b905061226761225a86602001518461381490919063ffffffff16565b829063ffffffff61388b16565b83019250505b5095945050505050565b6060806016600701546040519080825280602002602001820160405280156122a9578160200160208202803883390190505b50905060005b601d5481101561230c57600160a060020a0384166000908152600360209081526040808320848452600d01909152902054825160ff909116908390839081106122f457fe5b911515602092830291909101909101526001016122af565b5092915050565b60135490565b600160a060020a0381166000908152600c602052604081208190819061233e90612958565b905060005b8181101561238c57600160a060020a0385166000908152600c60205260408120612373908363ffffffff61296316565b905061237f81876116be565b9093019250600101612343565b50909392505050565b600054600160a060020a031615806123b75750600054600160a060020a031633145b6123f9576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b601355565b600054600160a060020a031615806124205750600054600160a060020a031633145b612462576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b841561246e57601f8590555b831561247a5760208490555b82156124865760218390555b81156124925760228290555b801561249e5760238190555b5050505050565b6000546060908190600160a060020a031615806124cc5750600054600160a060020a031633145b61250e576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b60105460ff1680156125215750600e5415155b1561254c57600e546125399060009060001901613c30565b612541613de6565b6010805460ff191690555b6125546118bc565b915091509091565b600054600160a060020a0316158061257e5750600054600160a060020a031633145b6125c0576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b600160a060020a0381166126085760405160e560020a62461bcd0281526004018080602001828103825260268152602001806154846026913960400191505060405180910390fd5b60008054604051600160a060020a03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a360008054600160a060020a031916600160a060020a0392909216919091179055565b61266c33613e63565b6040805133815290517f1082630c653c8dffd8888a62413c7140ad3d847809fd6ec16bdf9b758ddf821c9181900360200190a1565b600054600160a060020a031615806126c35750600054600160a060020a031633145b612705576040805160e560020a62461bcd02815260206004820181905260248201526000805160206155a7833981519152604482015290519081900360640190fd5b601155565b61271b60048263ffffffff61284516565b61275d576040805160e560020a62461bcd02815260206004820152601360248201526000805160206154aa833981519152604482015290519081900360640190fd5b600160a060020a0381166000908152600a6020526040902054806127b55760405160e560020a62461bcd0281526004018080602001828103825260218152602001806154f66021913960400191505060405180910390fd5b604051600160a060020a0383169082156108fc029083906000818181858888f193505050501580156127eb573d6000803e3d6000fd5b50600160a060020a0382166000818152600a60209081526040808320929092558151928352820183905280517fd08557b9e603c16831f1e4374c49cf0f14da892cfb57a9a08a6837d2326f08599281900390910190a15050565b600061285a83600160a060020a0384166140bb565b9392505050565b600080805b84518110156128c15784818151811061287b57fe5b60200260200101518301925083818151811061289357fe5b6020026020010151156128b9578481815181106128ac57fe5b6020026020010151820191505b600101612866565b5060014311156128e6576024546128e69082908490600160a060020a031688886140d3565b60248054600160a060020a0319164117905560005b84518110156129505761294886828151811061291357fe5b602002602001015186838151811061292757fe5b602002602001015186848151811061293b57fe5b60200260200101516141d7565b6001016128fb565b505050505050565b6000610fbb82614436565b600061285a838361443a565b61298060048463ffffffff61284516565b6129895761122a565b60408051600160a060020a03851681526020810184905260028183015290517f45a371af55b0726877a30f464edc14db5879ab096590bacce682cf6c182235969181900360600190a16129f1836129e783600163ffffffff61384916565b601c5485906144a1565b6129fa836146d5565b600160a060020a0383166000908152600960205260409020643afff4417f6004820155600201805460ff19166001179055505050565b600061285a83836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f000000000000815250614705565b600160a060020a03808416600090815260066020908152604080832093861683529290522054600711612ad95760405160e560020a62461bcd0281526004018080602001828103825260258152602001806156446025913960400191505060405180910390fd5b600160a060020a0383166000908152600d60205260409020612b01908363ffffffff61284516565b612b43576040805160e560020a62461bcd028152602060048201526014602482015260008051602061553c833981519152604482015290519081900360640190fd5b612b4d83836147aa565b600160a060020a038084166000908152600360209081526040808320600b8352818420948716845293909152812090612b8686856147b4565b90508082600001541015612be4576040805160e560020a62461bcd02815260206004820152601c60248201527f6e6f7420656e6f7567682064656c65676174696f6e2073686172657300000000604482015290519081900360640190fd5b81548190038255612bf58686614888565b600160a060020a0386811690861614808015612c165750600384015460ff16155b8015612c3257508360070154612c30888560000154612d68565b105b15612c4057612c40876146d5565b6000612c4c8884614892565b6009860180546001908101909155860154909150612c7790662386f26fc1000063ffffffff612a3016565b612c8957612c848861490e565b612c92565b612c9288614a07565b601b54600090612ca990429063ffffffff61389e16565b600160a060020a03808b166000818152600660209081526040808320948e168352938152838220845160608082018752898252438285019081528288018981528454600181810187559588529686902093516003909702909301958655519285019290925551600290930192909255835192835233908301528183018b9052810183905290519192507f54feacf7d18f42300ff65ba8829f17724df4915a8b1984c5fee2cc42d4027f07919081900360800190a1505050505050505050565b6000612d7261537a565b50600160a060020a0380841660009081526003602081815260409283902083516101408101855281549095168552600181015485830190815260028201548686019081529382015460ff16151560608088019190915285519081018652600483015481526005830154938101939093526006820154838601526080860192909252600781015460a0860152600881015460c0860152600981015460e0860152600c0154610100850152915161012084015251905161177e9190612e3c90869063ffffffff614aaa16565b9063ffffffff612a3016565b612e5960048463ffffffff61284516565b612e9b576040805160e560020a62461bcd02815260206004820152601360248201526000805160206154aa833981519152604482015290519081900360640190fd5b600160a060020a03831660009081526003602052604090208215612fb55762015180612ed482600801544261384990919063ffffffff16565b1015612f145760405160e560020a62461bcd0281526004018080602001828103825260318152602001806156136031913960400191505060405180910390fd5b6005810154831115612f5a5760405160e560020a62461bcd02815260040180806020018281038252602b8152602001806155e8602b913960400191505060405180910390fd5b60068101546004820154612f7590859063ffffffff61384916565b1115612fb55760405160e560020a62461bcd02815260040180806020018281038252603681526020018061544e6036913960400191505060405180910390fd5b811561306457806007015482116130005760405160e560020a62461bcd02815260040180806020018281038252602a81526020018061555c602a913960400191505060405180910390fd5b806001015482111561305c576040805160e560020a62461bcd02815260206004820152601d60248201527f73656c662064656c65676174696f6e2062656c6f77206d696e696d756d000000604482015290519081900360640190fd5b600781018290555b821561307857600481018390554260088201555b604080513381526020810185905280820184905290517f0cbf9ae83d6ba5a543e073cd712848d60903cb41413e549cd768096998ea57a69181900360600190a150505050565b600160a060020a0382166000908152600d602052604090206130e6908263ffffffff61284516565b613128576040805160e560020a62461bcd028152602060048201526014602482015260008051602061553c833981519152604482015290519081900360640190fd5b613130615363565b50600160a060020a038083166000818152600b60209081526040808320868616808552908352818420825180840184528154815260019091015490961686840152938352600382528083206006835281842094845293909152812090600290805b835481101561328857428482815481106131a757fe5b9060005260206000209060030201600201541015613280576131ec8482815481106131ce57fe5b6000918252602090912060039091020154849063ffffffff61389e16565b84549093508490600019810190811061320157fe5b906000526020600020906003020184828154811061321b57fe5b60009182526020909120825460039092020190815560018083015490820155600291820154910155835484908061324e57fe5b600082815260208120600019928301600381029091018281556001808201849055600290910192909255909255920191015b600101613191565b50600082116132e1576040805160e560020a62461bcd02815260206004820152601f60248201527f6e6f20756e626f6e64696e6720616d6f756e7420746f20776974686472617700604482015290519081900360640190fd5b604051600160a060020a0387169083156108fc029084906000818181858888f19350505050158015613317573d6000803e3d6000fd5b5060125461332b908363ffffffff61384916565b601255845115801561333c57508254155b1561334b5761334b8787614b06565b6009840154613360908263ffffffff61384916565b6009850155600284015415801561337957506009840154155b156133875761338787614ba7565b60408051600160a060020a03808a1682528816602082015280820184905290517f9b1bfa7fa9ee420a16e124f794c35ac9f90472acc99140eb2f6447c714cad8eb9181900360600190a150505050505050565b6133eb60048763ffffffff61284516565b15613440576040805160e560020a62461bcd02815260206004820152601760248201527f76616c696461746f7220616c7265616479206578697374000000000000000000604482015290519081900360640190fd5b60008511613498576040805160e560020a62461bcd02815260206004820152601960248201527f696e76616c69642064656c65676174696f6e20616d6f756e7400000000000000604482015290519081900360640190fd5b8085116134ef576040805160e560020a62461bcd02815260206004820152601d60248201527f73656c662064656c65676174696f6e2062656c6f77206d696e696d756d000000604482015290519081900360640190fd5b670de0b6b3a76400008311156135395760405160e560020a62461bcd02815260040180806020018281038252602c8152602001806154ca602c913960400191505060405180910390fd5b8282111561357b5760405160e560020a62461bcd02815260040180806020018281038252603c815260200180615699603c913960400191505060405180910390fd5b828411156135bd5760405160e560020a62461bcd0281526004018080602001828103825260308152602001806156696030913960400191505060405180910390fd5b6135c56153e3565b5060408051606081018252858152602081018590529081018390526135f160048863ffffffff614cae16565b50600160a060020a038716600081815260036020908152604091829020845160048201559084015160058201559083015160068201556007810184905542600882018190558154600160a060020a031916909217905561365088614cc3565b61365b888989613680565b505050600160a060020a03909416600090815260096020526040902043905550505050565b600160a060020a0382166000908152600d602052604090206136a8908463ffffffff61284516565b61374857600160a060020a0382166000908152600d602052604090206136d4908463ffffffff614cae16565b50600160a060020a0383166000908152600c602052604090206136fd908363ffffffff614cae16565b50600160a060020a038083166000908152600b602090815260408083209387168084529390915290206001018054600160a060020a031916909117905561374382614ccc565b613752565b61375282846147aa565b600061375e8383614cd5565b601254909150613774908363ffffffff61389e16565b601255600160a060020a038084166000908152600b6020908152604080832093881683529290522080546137ae908363ffffffff61389e16565b81556137ba8486614888565b6137c384614a07565b60408051600160a060020a0380871682528716602082015280820185905290517f510b11bb3f3c799b11307c01ab7db0d335683ef5b2da98f7697de744f465eacc9181900360600190a15050505050565b6000670de0b6b3a7640000826ec097ce7bc90715b34b9f100000000085028161383957fe5b048161384157fe5b049392505050565b600061285a83836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250614d54565b6000670de0b6b3a7640000838302613841565b60008282018381101561285a576040805160e560020a62461bcd02815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b600061390683614db1565b90506000613915848484613ac3565b600160a060020a0380861660009081526007602090815260408083209388168352929052206001015490915061394c908590614f4d565b600160a060020a038085166000908152600760209081526040808320938716835292905290812081815560018101829055600201558015613a0957604051600160a060020a0384169082156108fc029083906000818181858888f193505050501580156139bd573d6000803e3d6000fd5b5060408051600160a060020a0380871682528516602082015280820183905290517feb684bfe29b8ed3dea20bb7a06e215063c91298ef73d01421da812708d5b1dde9181900360600190a15b50505050565b600160a060020a038083166000818152600b60209081526040808320948616835293815283822092825260089052919091205460001901613a508482614fb5565b600160a060020a03848116600090815260076020908152604080832093871683529290529081204360028201556001018290558254613a90908690612d68565b600160a060020a039586166000908152600760209081526040808320979098168252959095529490932093909355505050565b6000613acd6153e3565b50600160a060020a03808516600081815260076020908152604080832094881683529381528382208451606081018652815481526001820154818401526002909101548186015292825260039052918220600c0154909190815b81811015613c0d57613b376153e3565b50600160a060020a0388166000908152600360209081526040808320848452600b0182529182902082516060810184528154815260018201549281019290925260020154818301819052918601519091118015613b975750438160400151105b15613c045780516020860151811115613c0257613bc28a876020015184600001518960000151614fea565b6020830151950194670de0b6b3a764000090613bf790613be990839063ffffffff61384916565b88519063ffffffff61388b16565b875250602086018190525b505b50600101613b27565b50613c22878460200151878660000151614fea565b909101925050509392505050565b818180821415613c415750506116ba565b6000613c5360028686030586016150ab565b90505b818313613dc2575b80613c68846150ab565b1115613c7957600190920191613c5e565b613c82826150ab565b811115613c955760001990910190613c79565b818313613dbd576000600e8481548110613cab57fe5b600091825260209091200154600e8054600160a060020a0390921692509084908110613cd357fe5b600091825260209091200154600e8054600160a060020a039092169186908110613cf957fe5b9060005260206000200160006101000a815481600160a060020a030219169083600160a060020a0316021790555080600e8481548110613d3557fe5b60009182526020808320919091018054600160a060020a031916600160a060020a039485161790559183168152600f91829052604081206001868101909155600e805491880193929188908110613d8857fe5b6000918252602080832090910154600160a060020a031683528201929092526040019020555060019290920191600019909101905b613c56565b81851215613dd457613dd48583613c30565b8383121561249e5761249e8385613c30565b600e545b61012c81111561179b57600f6000600e6001840381548110613e0857fe5b6000918252602080832090910154600160a060020a03168352820192909252604001812055600e805480613e3857fe5b60008281526020902081016000199081018054600160a060020a031916905590810190915501613dea565b613e7460048263ffffffff61284516565b613eb6576040805160e560020a62461bcd02815260206004820152601360248201526000805160206154aa833981519152604482015290519081900360640190fd5b600160a060020a03811660009081526003602081905260409091209081015460ff16613f2c576040805160e560020a62461bcd02815260206004820152601460248201527f76616c696461746f72206e6f74206a61696c6564000000000000000000000000604482015290519081900360640190fd5b600160a060020a03821660009081526009602052604090206002015460ff1615613fa0576040805160e560020a62461bcd02815260206004820152601060248201527f76616c696461746f72206a61696c656400000000000000000000000000000000604482015290519081900360640190fd5b600160a060020a038216600090815260096020526040902060040154428110614013576040805160e560020a62461bcd02815260206004820152601060248201527f76616c696461746f72206a61696c656400000000000000000000000000000000604482015290519081900360640190fd5b600160a060020a0383166000908152600b6020908152604080832090915281208054909190614043908690612d68565b90508360070154811161408a5760405160e560020a62461bcd0281526004018080602001828103825260218152602001806155c76021913960400191505060405180910390fd5b600160a060020a03851660009081526009602052604081206004015560038401805460ff1916905561249e85614a07565b60009081526001919091016020526040902054151590565b60006140e5868663ffffffff61381416565b60175490915060009061411190614102908463ffffffff61388b16565b6016549063ffffffff61389e16565b9050600061412a8260155461388b90919063ffffffff16565b905061413686826150bd565b670de0b6b3a764000061414f818463ffffffff61384916565b905060005b86518110156141cb5760006141858a88848151811061416f57fe5b602002602001015161381490919063ffffffff16565b905060006141a282611b178660155461388b90919063ffffffff16565b90506141c18984815181106141b357fe5b6020026020010151826150bd565b5050600101614154565b50505050505050505050565b600160a060020a038316600090815260036020908152604080832060099092528220601d546001820154929391928161420c57fe5b600180850180549091019055600160a060020a038816600090815260036020908152604080832094909306808352600d9094019052205490915060ff168415811580156142565750805b156142a057600380850180546001908101909155600160a060020a038a16600090815260209283526040808220878352600d0190935291909120805460ff191690911790556142e9565b8180156142ab575080155b156142e95760038085018054600019019055600160a060020a038916600090815260209182526040808220868352600d0190925220805460ff191690555b801561433d57600384015460408051600160a060020a038b16815260208101929092524382820152517ffce808888288e344693080c251304527eac43a033d1a4151fc74d24a67b47ec09181900360600190a15b601d548454601e549082019160009161435c919063ffffffff61388b16565b601d5490915081900343831080156143775750808760030154115b1561442957600388015460ff166144295760408051600160a060020a038d168152602081018c905260018183015290517f45a371af55b0726877a30f464edc14db5879ab096590bacce682cf6c182235969181900360600190a16143e58b600243038c6016600401546144a1565b6143ee8b6146d5565b60195461440290429063ffffffff61389e16565b60048801556000600380890182905560018901829055600160a060020a038d169091526020525b5050505050505050505050565b5490565b8154600090821061447f5760405160e560020a62461bcd02815260040180806020018281038252602281526020018061542c6022913960400191505060405180910390fd5b82600001828154811061448e57fe5b9060005260206000200154905092915050565b438311156144e35760405160e560020a62461bcd0281526004018080602001828103825260258152602001806155176025913960400191505060405180910390fd5b600160a060020a038416600090815260036020526040812090662386f26fc100009061451984611b17878563ffffffff614aaa16565b90504386101561465957600160a060020a0387166000908152600d6020526040812061454490612958565b905060005b8181101561465657600160a060020a0389166000908152600d60205260408120614579908363ffffffff61296316565b600160a060020a03808c16600090815260066020908152604080832093851683529290529081209192505b815481101561464b5760008282815481106145bb57fe5b906000526020600020906003020190508060000154600014156145de5750614643565b8b816001015410156145f05750614643565b42816002015410156146025750614643565b8054600090614617908c63ffffffff61388b16565b825490915061462c908263ffffffff61384916565b825561463e888263ffffffff61384916565b975050505b6001016145a4565b505050600101614549565b50505b6001830154819081111561466e575060018301545b60018401541561469f57600061469185600101548361381490919063ffffffff16565b905061469d8982615139565b505b60018401546146b4908263ffffffff61384916565b60018501556146c281615143565b6146cb8861490e565b5050505050505050565b600160a060020a038116600090815260036020819052604090912001805460ff1916600117905561179b8161490e565b600081836147945760405160e560020a62461bcd0281526004018080602001828103825283818151815260200191508051906020019080838360005b83811015614759578181015183820152602001614741565b50505050905090810190601f1680156147865780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b5060008385816147a057fe5b0495945050505050565b6116ba82826138fb565b60006147be61537a565b50600160a060020a0380841660009081526003602081815260409283902083516101408101855281549095168552600181015485830190815260028201548686019081529382015460ff16151560608088019190915285519081018652600483015481526005830154938101939093526006820154838601526080860192909252600781015460a0860152600881015460c0860152600981015460e0860152600c015461010085015291516101208401529051905161177e9190612e3c908663ffffffff614aaa16565b6116ba8282613a0f565b600160a060020a03821660009081526003602052604081206002810154826148c0828663ffffffff61384916565b9150816148d857506001820180546000909155614900565b6148e28686612d68565b60018401549091506148fa908263ffffffff61384916565b60018401555b600290920155905092915050565b600160a060020a0381166000908152600f602052604090205480614932575061179b565b600e805490600090600019830183811061494857fe5b600091825260209091200154600e8054600160a060020a0390921692508291600019860190811061497557fe5b60009182526020808320919091018054600160a060020a031916600160a060020a039485161790559183168152600f90915260409020839055600e8054806149b957fe5b6000828152602080822083016000199081018054600160a060020a0319169055909201909255600160a060020a0386168252600f9052604081205550506010805460ff191660011790555050565b600160a060020a0381166000908152600f602052604081205490614a2a8361161e565b905080614a3857505061179b565b81614a9857600e80546001810182557fbb7b4a454dc3493923482f07822329ed19e8244eff582cc204f8554c3620c3fd018054600160a060020a031916600160a060020a03861690811790915590546000918252600f6020526040909120555b50506010805460ff1916600117905550565b600082614ab957506000610fbb565b82820282848281614ac657fe5b041461285a5760405160e560020a62461bcd0281526004018080602001828103825260218152602001806155866021913960400191505060405180910390fd5b600160a060020a0382166000908152600d60205260409020614b2e908263ffffffff61518b16565b50600160a060020a038083166000818152600b6020908152604080832094861680845294825280832083815560019081018054600160a060020a0319169055938352600782528083209483529381528382208281559283018290556002909201819055600c9091522061122a908363ffffffff61518b16565b614bb860048263ffffffff61518b16565b50600160a060020a0381166000908152600a60205260409020548015614bef57601154614beb908263ffffffff61384916565b6011555b600160a060020a0382166000908152600a602090815260408083208390556008808352818420848155600190810185905560098085528386208681558083018790556002808201805460ff1990811690915560038084018a905560049384018a9055978890529588208054600160a060020a03191681559384018890558301879055948201805490941690935592830184905560058301849055600683018490556007830184905582018390558101829055600c01556116ba8261490e565b600061285a83600160a060020a0384166151a0565b61179b816151ea565b6116ba81614db1565b600160a060020a038216600090815260036020526040812060018101548290614d075750670de0b6b3a7640000614d14565b614d1185856147b4565b90505b6001820154614d29908563ffffffff61389e16565b60018301556002820154614d43908263ffffffff61389e16565b600290920191909155905092915050565b60008184841115614da95760405160e560020a62461bcd028152602060048201818152835160248401528351909283926044909101919085019080838360008315614759578181015183820152602001614741565b505050900390565b6000614dbb61537a565b50600160a060020a03808316600081815260036020818152604080842081516101408101835281549097168752600180820154888501526002820154888401529381015460ff16151560608089019190915282519081018352600482015481526005820154818501526006820154818401526080880152600781015460a088015260088082015460c0890152600982015460e0890152600c90910154610100880152815161012088015294845293905291812080549092614e82919063ffffffff61384916565b600183015490915060009015614eae5760208401516001840154614eab9163ffffffff61381416565b90505b600160a060020a0386166000908152600360209081526040808320858452600a01909152902054614edf8784614f4d565b614eef818363ffffffff61389e16565b600160a060020a038816600090815260036020908152604080832088548452600a019091528082209290925585548152908120600190810181905585548101865580860191909155614f4290849061389e565b979650505050505050565b600160a060020a0382166000908152600360209081526040808320848452600a019091529020600101805460001901908190556116ba57600160a060020a0382166000908152600360209081526040808320848452600a019091528120818155600101555050565b600160a060020a039091166000908152600360209081526040808320938352600a909301905220600190810180549091019055565b6000614ff4615404565b50600160a060020a0385166000908152600360209081526040808320878452600a018252918290208251808401909352805483526001015490820152615038615404565b50600160a060020a0386166000908152600360209081526040808320878452600a0182528083208151808301909252805480835260019091015492820192909252835190929161508d9163ffffffff61384916565b905061509f858263ffffffff61388b16565b98975050505050505050565b6000610fbb600e83815481106119a357fe5b600160a060020a0382166000908152600360205260408120600401546150ea90839063ffffffff61388b16565b905060006150fe838363ffffffff61384916565b600160a060020a039094166000908152600a602090815260408083208054909501909455600890529190912060010180549093019092555050565b6116ba8282615217565b6012805482900390556011805482900390556040805182815290517fb90306ad06b2a6ff86ddc9327db583062895ef6540e62dc50add009db5b356eb9181900360200190a150565b600061285a83600160a060020a03841661529d565b60006151ac83836140bb565b6151e257508154600181810184556000848152602080822090930184905584548482528286019093526040902091909155610fbb565b506000610fbb565b600160a060020a03166000908152600860209081526040808320600180825501839055600a909152812055565b600061522283614db1565b905061522e8382614fb5565b60408051606081018252918252602080830193845243838301908152600160a060020a0390951660008181526003808452848220600c810180548452600b9091018552948220955186559551600180870191909155965160029095019490945590925291905280549091019055565b6000818152600183016020526040812054801561535957835460001980830191908101906000908790839081106152d057fe5b90600052602060002001549050808760000184815481106152ed57fe5b60009182526020808320909101929092558281526001898101909252604090209084019055865487908061531d57fe5b60019003818190600052602060002001600090559055866001016000878152602001908152602001600020600090556001945050505050610fbb565b6000915050610fbb565b604080518082019091526000808252602082015290565b6040518061014001604052806000600160a060020a0316815260200160008152602001600081526020016000151581526020016153b56153e3565b8152602001600081526020016000815260200160008152602001600081526020016153de61541e565b905290565b60405180606001604052806000815260200160008152602001600081525090565b604051806040016040528060008152602001600081525090565b604051806020016040529056fe456e756d657261626c655365743a20696e646578206f7574206f6620626f756e6473636f6d6d697373696f6e2063616e6e6f74206265206368616e676564206d6f7265207468616e206d6178206368616e676520726174654f776e61626c653a206e6577206f776e657220697320746865207a65726f206164647265737376616c696461746f72206e6f7420666f756e6400000000000000000000000000636f6d6d697373696f6e206d617820726174652063616e6e6f74206265206d6f7265207468616e20313030256e6f2076616c696461746f7220636f6d6d697373696f6e20746f2072657761726463616e6e6f7420736c61736820696e66726174696f6e7320696e207468652066757475726564656c65676174696f6e206e6f7420666f756e640000000000000000000000006d696e696d756d2073656c662064656c65676174696f6e2063616e6e6f74206265206465637265617365536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f774f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e657273656c662064656c65676174696f6e20746f6f206c6f7720746f20756e6a61696c636f6d6d697373696f6e2063616e6e6f74206265206d6f7265207468616e20746865206d61782072617465636f6d6d697373696f6e2063616e6e6f74206265206368616e676564206d6f7265207468616e206f6e6520696e20323468746f6f206d616e7920756e626f6e64696e672064656c65676174696f6e20656e7472696573636f6d6d697373696f6e20726174652063616e6e6f74206265206d6f7265207468616e20746865206d61782072617465636f6d6d697373696f6e206d6178206368616e676520726174652063616e206e6f74206265206d6f7265207468616e20746865206d61782072617465a26469706673582212206538926cd8f5821e0e4896ae9dc6dac04dc3341c6e9188036cd9c8a392718d0964736f6c63430006000033")

var stakingSmcDefinition = `[
    {
      "inputs": [],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "Burn",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address payable",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "commissionRate",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "commissionMaxRate",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "commissionMaxChangeRate",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "minSelfDelegation",
          "type": "uint256"
        }
      ],
      "name": "CreateValidator",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "Delegate",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "missedBlocks",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "blockHeight",
          "type": "uint256"
        }
      ],
      "name": "Liveness",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "Minted",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "previousOwner",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "address",
          "name": "newOwner",
          "type": "address"
        }
      ],
      "name": "OwnershipTransferred",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "power",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "reason",
          "type": "uint256"
        }
      ],
      "name": "Slashed",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "UnJail",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "completionTime",
          "type": "uint256"
        }
      ],
      "name": "Undelegate",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "commissionRate",
          "type": "uint256"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "minSelfDelegation",
          "type": "uint256"
        }
      ],
      "name": "UpdateValidator",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "Withdraw",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "rewards",
          "type": "uint256"
        }
      ],
      "name": "WithdrawCommissionReward",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": false,
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "rewards",
          "type": "uint256"
        }
      ],
      "name": "WithdrawDelegationRewards",
      "type": "event"
    },
    {
      "inputs": [],
      "name": "annualProvision",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "inflation",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "owner",
      "outputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "renounceOwnership",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "totalBonded",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "totalSupply",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "newOwner",
          "type": "address"
        }
      ],
      "name": "transferOwnership",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "deposit",
      "outputs": [],
      "stateMutability": "payable",
      "type": "function",
      "payable": true
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "maxValidators",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "downtimeJailDuration",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "baseProposerReward",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "bonusProposerReward",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "slashFractionDowntime",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "unbondingTime",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "slashFractionDoubleSign",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "signedBlockWindow",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "minSignedPerWindow",
          "type": "uint256"
        }
      ],
      "name": "setParams",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "setTotalBonded",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "inflationRateChange",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "goalBonded",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "blocksPerYear",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "inflationMax",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "inflationMin",
          "type": "uint256"
        }
      ],
      "name": "setMintParams",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getMintParams",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "commssionRate",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "maxRate",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "maxChangeRate",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "minSeftDelegation",
          "type": "uint256"
        }
      ],
      "name": "createValidator",
      "outputs": [],
      "stateMutability": "payable",
      "type": "function",
      "payable": true
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "commissionRate",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "minSelfDelegation",
          "type": "uint256"
        }
      ],
      "name": "updateValidator",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "delegate",
      "outputs": [],
      "stateMutability": "payable",
      "type": "function",
      "payable": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "undelegate",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getTotalSupply",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "withdraw",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "withdrawReward",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        }
      ],
      "name": "getDelegationRewards",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "withdrawValidatorCommission",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "getValidator",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        },
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "getDelegationsByValidator",
      "outputs": [
        {
          "internalType": "address[]",
          "name": "",
          "type": "address[]"
        },
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        }
      ],
      "name": "getDelegation",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        }
      ],
      "name": "getValidatorsByDelegator",
      "outputs": [
        {
          "internalType": "address[]",
          "name": "",
          "type": "address[]"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "getValidatorCommission",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        }
      ],
      "name": "getAllDelegatorRewards",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        }
      ],
      "name": "getDelegatorStake",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        }
      ],
      "name": "getAllDelegatorStake",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "delAddr",
          "type": "address"
        }
      ],
      "name": "getUBDEntries",
      "outputs": [
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        },
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "getValidatorSlashEvents",
      "outputs": [
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        },
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "votingPower",
          "type": "uint256"
        },
        {
          "internalType": "uint256",
          "name": "distributionHeight",
          "type": "uint256"
        }
      ],
      "name": "doubleSign",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address[]",
          "name": "addrs",
          "type": "address[]"
        },
        {
          "internalType": "uint256[]",
          "name": "powers",
          "type": "uint256[]"
        },
        {
          "internalType": "bool[]",
          "name": "signed",
          "type": "bool[]"
        }
      ],
      "name": "finalizeCommit",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "previousProposer",
          "type": "address"
        }
      ],
      "name": "setPreviousProposer",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getValidators",
      "outputs": [
        {
          "internalType": "address[]",
          "name": "",
          "type": "address[]"
        },
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        },
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "getMissedBlock",
      "outputs": [
        {
          "internalType": "bool[]",
          "name": "",
          "type": "bool[]"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "mint",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "_inflation",
          "type": "uint256"
        }
      ],
      "name": "setInflation",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "nextInflationRate",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "nextAnnualProvisions",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "_annualProvision",
          "type": "uint256"
        }
      ],
      "name": "setAnnualProvision",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getBlockProvision",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "setTotalSupply",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getInflation",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "applyAndReturnValidatorSets",
      "outputs": [
        {
          "internalType": "address[]",
          "name": "",
          "type": "address[]"
        },
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getValidatorSets",
      "outputs": [
        {
          "internalType": "address[]",
          "name": "",
          "type": "address[]"
        },
        {
          "internalType": "uint256[]",
          "name": "",
          "type": "uint256[]"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "valAddr",
          "type": "address"
        }
      ],
      "name": "getValidatorPower",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "unjail",
      "outputs": [],
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ]`

func setupGenesis(g *genesis.Genesis, db types.StoreDB) (*types.ChainConfig, common.Hash, error) {
	address := common.HexToAddress("0xc1fe56E3F58D3244F606306611a5d10c8333f1f6")
	privateKey, _ := crypto.HexToECDSA("8843ebcb1021b00ae9a644db6617f9c6d870e5fd53624cefe374c1d2d710fd06")
	return genesis.SetupGenesisBlock(log.New(), db, g, &types.BaseAccount{
		Address:    address,
		PrivateKey: *privateKey,
	})
}

func SetupBlockchain() (*blockchain.BlockChain, error) {
	initValue := genesis.ToCell(int64(math.Pow10(6)))

	var genesisAccounts = map[string]*big.Int{
		"0x1234": initValue,
		"0x5678": initValue,
		"0xabcd": initValue,
		"0xc1fe56E3F58D3244F606306611a5d10c8333f1f6": initValue,
		"0xfF3dac4f04dDbD24dE5D6039F90596F0a8bb08fd": initValue,
	}
	blockDB := memorydb.New()
	kaiDb := kvstore.NewStoreDB(blockDB)
	g := genesis.DefaulTestnetFullGenesisBlock(genesisAccounts, map[string]string{})
	chainConfig, _, genesisErr := setupGenesis(g, kaiDb)
	if genesisErr != nil {
		return nil, genesisErr
	}

	bc, err := blockchain.NewBlockChain(log.New(), kaiDb, chainConfig, true)
	return bc, err
}

func TestSetInflation(t *testing.T) {
	bc, err := SetupBlockchain()
	if err != nil {
		t.Fatal(err)
	}
	state, err := bc.State()
	if err != nil {
		t.Fatal(err)
	}
	// Setup contract code into genesis state
	address := common.HexToAddress("0x0a")
	validator := common.HexToAddress("0x1111")

	state.SetCode(address, stakingSmcCode)
	abi, err := abi.JSON(strings.NewReader(stakingSmcDefinition))
	if err != nil {
		t.Fatal(err)
	}

	// Successfully
	setInflation, err := abi.Pack("setInflation", big.NewInt(100))
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, setInflation, &sample_kvm.Config{State: state, Origin: validator})
	if err != nil {
		t.Fatal(err)
	}

	getInflation, err := abi.Pack("getInflation")
	if err != nil {
		t.Fatal(err)
	}
	result, _, err := sample_kvm.Call(address, getInflation, &sample_kvm.Config{State: state})
	if err != nil {
		t.Fatal(err)
	}

	num := new(big.Int).SetBytes(result)
	if num.Cmp(big.NewInt(100)) != 0 {
		t.Error("Expected 100, got ", num)
	}
}

func TestSetTotalSupply(t *testing.T) {
	bc, err := SetupBlockchain()
	if err != nil {
		t.Fatal(err)
	}
	state, err := bc.State()
	if err != nil {
		t.Fatal(err)
	}
	owner := common.HexToAddress("0x1111")

	// Setup contract code into genesis state
	address := common.HexToAddress("0x0a")
	state.SetCode(address, stakingSmcCode)
	abi, err := abi.JSON(strings.NewReader(stakingSmcDefinition))
	if err != nil {
		t.Fatal(err)
	}

	// Successfully
	setTotalSupply, err := abi.Pack("setTotalSupply", big.NewInt(200000))
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, setTotalSupply, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}

	getTotalSupply, err := abi.Pack("getTotalSupply")
	if err != nil {
		t.Fatal(err)
	}
	result, _, err := sample_kvm.Call(address, getTotalSupply, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	num := new(big.Int).SetBytes(result)
	if num.Cmp(big.NewInt(200000)) != 0 {
		t.Error("Expected 200000, got ", num)
	}

}
func TestCreateValidator(t *testing.T) {
	bc, err := SetupBlockchain()
	if err != nil {
		t.Fatal(err)
	}
	state, err := bc.State()
	if err != nil {
		t.Fatal(err)
	}
	owner := common.HexToAddress("0x1234")
	// Setup contract code into genesis state
	address := common.HexToAddress("0x0a")
	state.SetCode(address, stakingSmcCode)
	abi, err := abi.JSON(strings.NewReader(stakingSmcDefinition))
	if err != nil {
		t.Fatal(err)
	}
	baseProposerReward := big.NewInt(1)
	bonusProposerReward := big.NewInt(1)
	slashFractionDowntime := big.NewInt(1)
	slashFractionDoubleSign := big.NewInt(2)
	unBondingTime := big.NewInt(1)
	signedBlockWindow := big.NewInt(2)
	minSignedBlockPerWindow := big.NewInt(1)
	// set params
	setParams, err := abi.Pack("setParams", big.NewInt(100), big.NewInt(600), baseProposerReward, bonusProposerReward, slashFractionDowntime, slashFractionDoubleSign, unBondingTime, signedBlockWindow, minSignedBlockPerWindow)
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, setParams, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	// owner := common.HexToAddress("0x1111")
	// // Successfully
	// setTotalSupply, err := abi.Pack("setTotalSupply", big.NewInt(200000))
	// if err != nil {
	// 	t.Fatal(err)
	// }
	// _, _, err = sample_kvm.Call(address, setTotalSupply, &sample_kvm.Config{State: state, Origin: owner})
	// if err != nil {
	// 	t.Fatal(err)
	// }
	// Successfully
	validator1 := common.HexToAddress("0xc1fe56E3F58D3244F606306611a5d10c8333f1f6")
	maxRate := big.NewInt(20)
	maxChangeRate := big.NewInt(5)
	minSelfDelegation := big.NewInt(5)
	createValidator, err := abi.Pack("createValidator", big.NewInt(2), maxRate, maxChangeRate, minSelfDelegation)
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, createValidator, &sample_kvm.Config{State: state, Value: big.NewInt(3999999999), Origin: validator1})
	if err != nil {
		t.Fatal(err)
	}
	//check get delegation
	getDelegation, err := abi.Pack("getDelegation", validator1, validator1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err := sample_kvm.Call(address, getDelegation, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	num := new(big.Int).SetBytes(result)
	if num.Cmp(big.NewInt(1000000000000000000)) != 0 {
		t.Error("Expected delegation 1000000000000000000, got #", num)
	}
	//check get validator
	getValidator, err := abi.Pack("getValidator", validator1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getValidator, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	//check bond
	num = new(big.Int).SetBytes(result[:32])
	if num.Cmp(big.NewInt(3999999999)) != 0 {
		t.Error("Expected delegation 3999999999, got #", num)
	}
	//check delegation shares
	num = new(big.Int).SetBytes(result[32:64])
	if num.Cmp(big.NewInt(1000000000000000000)) != 0 {
		t.Error("Expected delegation 1000000000000000000, got #", num)
	}
	//check get validators
	getValidators, err := abi.Pack("getValidators")
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getValidators, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	//length of address array  result[96:128]
	// t.Log((result[96:128]))
	//check get address of validator from getValidators
	validatorAddress := string(hex.EncodeToString(result[140:160]))
	// t.Log(validatorAddress)
	if strings.TrimRight(validatorAddress, "\n") != "c1fe56e3f58d3244f606306611a5d10c8333f1f6" {
		t.Error("Error for address")
	}
	//check get token of validator from getValidators
	num = new(big.Int).SetBytes(result[192:224])
	if num.Cmp(big.NewInt(3999999999)) != 0 {
		t.Error("Expected delegation 3999999999, got #", num)
	}
	//check delegations shares from getValidators
	num = new(big.Int).SetBytes(result[256:288])
	if num.Cmp(big.NewInt(1000000000000000000)) != 0 {
		t.Error("Expected delegation 1000000000000000000, got #", num)
	}
	//check get getAllDelegatorStake
	getAllDelegatorStake, err := abi.Pack("getAllDelegatorStake", validator1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getAllDelegatorStake, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	num = new(big.Int).SetBytes(result)
	if num.Cmp(big.NewInt(3999999999)) != 0 {
		t.Error("Expected delegation 3999999999, got #", num)
	}
	// check jail, pending
	// jail := (result[64:])
	// t.Log(jail)
	// num := new(big.Int).SetBytes(result)
	// if num.Cmp(big.NewInt(1000000000000000000)) != 0 {
	// 	t.Error("Expected delegation 1000000000000000000, got #", num)
	// }
	// check getValidators
	// getValidator, err := abi.Pack("getDelegationsByValidator", validator1)
	// if err != nil {
	// 	t.Fatal(err)
	// }
	// result, _, err := sample_kvm.Call(address, getValidator, &sample_kvm.Config{State: state})
	// if err != nil {
	// 	t.Fatal(err)
	// }
	// t.Log("resultsss", result)
	// num := new(big.Int).SetBytes(result)
	// if num.Cmp(big.NewInt(1)) != 0 {
	// 	t.Error("Expected candidate 2 to rank #1, got #", num)
	// }
}
func TestDelegate(t *testing.T) {
	bc, err := SetupBlockchain()
	if err != nil {
		t.Fatal(err)
	}
	state, err := bc.State()
	if err != nil {
		t.Fatal(err)
	}
	owner := common.HexToAddress("0x1234")
	// Setup contract code into genesis state
	address := common.HexToAddress("0x0a")
	state.SetCode(address, stakingSmcCode)
	abi, err := abi.JSON(strings.NewReader(stakingSmcDefinition))
	if err != nil {
		t.Fatal(err)
	}
	baseProposerReward := big.NewInt(1)
	bonusProposerReward := big.NewInt(1)
	slashFractionDowntime := big.NewInt(1)
	slashFractionDoubleSign := big.NewInt(2)
	unBondingTime := big.NewInt(1)
	signedBlockWindow := big.NewInt(2)
	minSignedBlockPerWindow := big.NewInt(1)
	// set params
	setParams, err := abi.Pack("setParams", big.NewInt(100), big.NewInt(600), baseProposerReward, bonusProposerReward, slashFractionDowntime, slashFractionDoubleSign, unBondingTime, signedBlockWindow, minSignedBlockPerWindow)
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, setParams, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}

	//create validator
	validator1 := common.HexToAddress("0xc1fe56E3F58D3244F606306611a5d10c8333f1f6")
	maxRate := big.NewInt(20)
	maxChangeRate := big.NewInt(5)
	minSelfDelegation := big.NewInt(5)
	createValidator, err := abi.Pack("createValidator", big.NewInt(2), maxRate, maxChangeRate, minSelfDelegation)
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, createValidator, &sample_kvm.Config{State: state, Value: big.NewInt(3999999999), Origin: validator1})
	if err != nil {
		t.Fatal(err)
	}
	//check delegate
	bond1 := big.NewInt(20000)
	// bond2 := big.NewInt(20000)
	account1 := common.HexToAddress("0xfF3dac4f04dDbD24dE5D6039F90596F0a8bb08fd")
	// account2 := common.HexToAddress("0x5678")
	delegate, err := abi.Pack("delegate", validator1)
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, delegate, &sample_kvm.Config{State: state, Value: bond1, Origin: account1})
	if err != nil {
		t.Fatal(err)
	}

	//check get delegation
	getValidatorsByDelegator, err := abi.Pack("getValidatorsByDelegator", account1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err := sample_kvm.Call(address, getValidatorsByDelegator, &sample_kvm.Config{State: state, Origin: account1})
	if err != nil {
		t.Fatal(err)
	}
	validatorAddress := string(hex.EncodeToString(result[76:96]))
	if strings.TrimRight(validatorAddress, "\n") != "c1fe56e3f58d3244f606306611a5d10c8333f1f6" {
		t.Error("Error for address")
	}

	//check get delegation
	getDelegation, err := abi.Pack("getDelegation", validator1, account1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getDelegation, &sample_kvm.Config{State: state, Origin: account1})
	if err != nil {
		t.Fatal(err)
	}
	num := new(big.Int).SetBytes(result)
	if num.Cmp(big.NewInt(5000000001250)) != 0 {
		t.Error("Expected delegation 5000000001250, got #", num)
	}

	//check get delegation by validator
	getDelegationsByValidator, err := abi.Pack("getDelegationsByValidator", validator1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getDelegationsByValidator, &sample_kvm.Config{State: state, Origin: validator1})
	if err != nil {
		t.Fatal(err)
	}
	// t.Log(len(result))
	delAddress := string(hex.EncodeToString(result[140:160]))
	if strings.TrimRight(delAddress, "\n") != "ff3dac4f04ddbd24de5d6039f90596f0a8bb08fd" {
		t.Error("Error for address")
	}
	// t.Log(result)
	// t.Log(result[160:192])
	// num = new(big.Int).SetBytes(result[224:256])
	// t.Log(num)
	// if num.Cmp(big.NewInt(5000000001250)) != 0 {
	// 	t.Error("Expected delegation 5000000001250, got #", num)
	// }
	getAllDelegatorStake, err := abi.Pack("getAllDelegatorStake", account1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getAllDelegatorStake, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	num = new(big.Int).SetBytes(result)
	t.Log(num)

	// check undelegate
	amountUndel := big.NewInt(500)
	undelegate, err := abi.Pack("undelegate", validator1, amountUndel)
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, undelegate, &sample_kvm.Config{State: state, Origin: account1})
	if err != nil {
		t.Fatal(err)
	}

	getAllDelegatorStake, err = abi.Pack("getAllDelegatorStake", account1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getAllDelegatorStake, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	num = new(big.Int).SetBytes(result)
	if num.Cmp(big.NewInt(19500)) != 0 {
		t.Error("Expected delegation 19500, got #", num)
	}

	//check get getAllDelegatorStake
	getUBDEntries, err := abi.Pack("getUBDEntries", validator1, account1)
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, getUBDEntries, &sample_kvm.Config{State: state, Origin: owner})
	if err != nil {
		t.Fatal(err)
	}
	// t.Log(len(result))
	num = new(big.Int).SetBytes(result[96:128])
	if num.Cmp(big.NewInt(499)) != 0 {
		t.Error("Expected delegation 499, got #", num)
	}

	//check apply and return validator sets
	applyAndReturnValidatorSets, err := abi.Pack("applyAndReturnValidatorSets")
	if err != nil {
		t.Fatal(err)
	}
	result, _, err = sample_kvm.Call(address, applyAndReturnValidatorSets, &sample_kvm.Config{State: state, Origin: validator1})
	if err != nil {
		t.Fatal(err)
	}

	// check withdraw
	withdraw, err := abi.Pack("withdraw", validator1)
	if err != nil {
		t.Fatal(err)
	}
	_, _, err = sample_kvm.Call(address, withdraw, &sample_kvm.Config{State: state, Origin: validator1})
	if err != nil {
		t.Fatal(err)
	}
}
